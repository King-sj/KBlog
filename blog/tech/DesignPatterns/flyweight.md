---
title: Flyweight 模式
date: 2024-10-28
category:
  - 设计模式
tag:
  - 设计模式
  - TypeScript
  - 避免浪费
prev: ./state
next: false
---

## 实例代码
```ts
// bigChar.ts
export class BigChar {
  charname: string;
  fontdata: string;
  static fontdatas: { [key: string]: string } = {
    "0":
      ".....######.....\n" +
      "....##....##....\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "...##......##...\n" +
      "....##....##....\n" +
      ".....######.....\n",
    "1":
      ".......##.......\n" +
      ".....####.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".......##.......\n" +
      ".....######.....\n" +
      "................\n",
    "2":
      ".....######.....\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..........##....\n" +
      ".........##.....\n" +
      ".......##.......\n" +
      "......##........\n" +
      ".....##.........\n" +
      "...##...........\n" +
      "....##########..\n" +
      "................\n",
    "3":
      ".....######.....\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..........##....\n" +
      ".........##.....\n" +
      "......####......\n" +
      ".........##.....\n" +
      "..........##....\n" +
      "..##........##..\n" +
      "...##......##...\n" +
      ".....######.....\n",
    "4":
      "........###.....\n" +
      ".......####.....\n" +
      "......##.##.....\n" +
      ".....##..##.....\n" +
      "....##...##.....\n" +
      "...##....##.....\n" +
      "..##########....\n." +
      "........##......\n" +
      "........##......\n" +
      ".......######...\n",
    "5":
      "....########....\n" +
      "....########....\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....######......\n" +
      "....######......\n" +
      "..........##....\n" +
      "..........##....\n" +
      "...........##...\n" +
      "...........##...\n" +
      "...........##...\n" +
      "...........##...\n" +
      "..##.......##...\n" +
      "..##.......##...\n" +
      "...##......##...\n" +
      "...##......##...\n" +
      ".....######.....\n",
    "6":
      ".......####.....\n" +
      "......##........\n" +
      ".....##.........\n" +
      "....##..........\n" +
      "...##...........\n" +
      "..######........\n" +
      "..##...##.......\n" +
      "..##....##......\n" +
      "..##.....##.....\n" +
      "...##....##.....\n" +
      "....####........\n",
    "7":
      "..##########....\n" +
      "..##......##....\n" +
      "........##......\n" +
      ".......##.......\n" +
      "......##........\n" +
      "......##........\n" +
      ".....##.........\n" +
      ".....##.........\n" +
      "....##..........\n" +
      "....##..........\n" +
      "....##..........\n",
    "8":
      ".....######.....\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "...##......##...\n" +
      "....######......\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "...##......##...\n" +
      ".....######.....\n",
    "9":
      ".....######.....\n" +
      "...##......##...\n" +
      "..##........##..\n" +
      "..##........##..\n" +
      "...##......##...\n" +
      "....#######.....\n" +
      "..........##....\n" +
      ".........##.....\n" +
      "........##......\n" +
      "......###.......\n" +
      ".....##.........\n",
  };
  constructor(charname: string) {
    this.charname = charname;
    this.fontdata = BigChar.fontdatas[charname];
    this.fontdata = this.fontdata.replace(/#/g, charname);
  }
  print(): void {
    console.log(this.fontdata);
  }
}
// bigCharFactory.ts
import { BigChar } from './bigChar';
export class BigCharFactory {
  private pool: Map<string, BigChar> = new Map();
  private static singleton: BigCharFactory = new BigCharFactory();
  private constructor() { }
  public static getInstance(): BigCharFactory {
    return BigCharFactory.singleton;
  }
  public getBigChar(charname: string): BigChar {
    let bc: BigChar = this.pool.get(charname);
    // ts 是单线程的，所以不需要考虑多线程问题， 若为多线程则需要加锁
    if (bc == null) {
      bc = new BigChar(charname);
      this.pool.set(charname, bc);
    }
    return bc;
  }
}
// bigString.ts
import { Factory } from '../abstractFactory/factory';
import { BigChar } from './bigChar';
import { BigCharFactory } from './bigCharFactory';
export class BigString {
  bigchars: BigChar[] = [];
  constructor(public str: string) {
    let factory = BigCharFactory.getInstance();
    str.split('').forEach((char) => {
      this.bigchars.push(factory.getBigChar(char));
    });
  }
  print() {
    this.bigchars.forEach((bigchar) => {
      bigchar.print();
    });
  }
}
// main.ts
import { BigString } from './bigString';
let bs: BigString = new BigString('123');
bs.print();
```

## 运行结果
```sh
PS design_patern> ts-node "d:\code\design_patern\src\flyweight\main.ts"
.......11.......
.....1111.......
.......11.......
.......11.......
.......11.......
.......11.......
.......11.......
.......11.......
.......11.......
.....111111.....
................

.....222222.....
...22......22...
..22........22..
..........22....
.........22.....
.......22.......
......22........
.....22.........
...22...........
....2222222222..
................

.....333333.....
...33......33...
..33........33..
..........33....
.........33.....
......3333......
.........33.....
..........33....
..33........33..
...33......33...
.....333333.....
```
